{% extends 'base.html' %}

{% block content %}
<h2>Boş Randevu Slotları</h2>
<p class="text-muted">Yalnızca temsilcisi olmayan (boş) slotlar listelenir. İsterseniz silerek takvimi sadeleştirebilirsiniz.</p>
<hr>

<form class="row g-2 align-items-end mb-3" method="get">
  <div class="col-auto">
    <label class="form-label">Başlangıç</label>
    <input type="date" class="form-control" name="start" value="{{ start }}">
  </div>
  <div class="col-auto">
    <label class="form-label">Bitiş</label>
    <input type="date" class="form-control" name="end" value="{{ end }}">
  </div>
  <div class="col-auto">
    <button class="btn btn-outline-primary" type="submit">Filtrele</button>
    <a class="btn btn-outline-secondary" href="{% url 'yonetim_bos_randevular' %}">Sıfırla</a>
  </div>
</form>

{% if messages %}
  {% for message in messages %}
    <div class="alert alert-{{ message.tags|default:'info' }} alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  {% endfor %}
{% endif %}

{% if randevular %}
  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead>
        <tr>
          <th>Tarih ve Saat</th>
          <th class="text-end">İşlemler</th>
        </tr>
      </thead>
      <tbody>
        {% for r in randevular %}
        <tr>
          <td>{{ r.tarih_saat|date:"d F Y, l - H:i" }}</td>
          <td class="text-end">
            <form method="POST" action="{% url 'yonetim_randevu_sil' r.id %}" onsubmit="return confirm('Bu boş slotu silmek istediğinizden emin misiniz?');" style="display:inline;">
              {% csrf_token %}
              <button type="submit" class="btn btn-danger btn-sm">Sil</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <nav aria-label="Sayfalama" class="mt-3">
    <ul class="pagination">
      {% if randevular.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?start={{ start }}&end={{ end }}&page={{ randevular.previous_page_number }}">Önceki</a>
        </li>
      {% endif %}
      <li class="page-item disabled">
        <span class="page-link">Sayfa {{ randevular.number }} / {{ randevular.paginator.num_pages }}</span>
      </li>
      {% if randevular.has_next %}
        <li class="page-item">
          <a class="page-link" href="?start={{ start }}&end={{ end }}&page={{ randevular.next_page_number }}">Sonraki</a>
        </li>
      {% endif %}
    </ul>
  </nav>
{% else %}
  <div class="alert alert-warning" role="alert">Belirtilen aralıkta boş randevu slotu yok.</div>
{% endif %}
{% endblock %}
